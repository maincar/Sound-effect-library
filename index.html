<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>効果音リンク集</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: system-ui, sans-serif;
  margin: 0;
  padding: 12px;
  background: #f5f5f5;
}

h1 {
  text-align: center;
  margin-bottom: 12px;
}

#list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 12px;
}

.card {
  background: #fff;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  text-decoration: none;
  color: #000;
}

.card img {
  width: 100%;
  aspect-ratio: 16 / 9;
  object-fit: cover;
}

.card h3 {
  font-size: 14px;
  margin: 8px;
}

.card p {
  font-size: 12px;
  color: #666;
  margin: 0 8px 8px;
}
</style>
</head>

<body>

<h1>効果音リンク集</h1>
<div id="list">読み込み中…</div>

<script>
const SHEET_ID = "1yYBbIRLX4nSNAR1s-GnOc6jRyzDC_7xNNHbmROEqx7s";
const SHEET_NAME = "シート1";

const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${SHEET_NAME}`;

const params = new URLSearchParams(location.search);
const soundSlug = params.get("sound");

fetch(CSV_URL)
  .then(res => res.text())
  .then(text => {
    const rows = text.trim().split("\n").slice(1);

    const data = rows.map(row => {
      const cols = row.split(",");

      const title = cols[0]?.replace(/"/g,"").trim();
      const url   = cols[1]?.replace(/"/g,"").trim();
      const category = cols[2]?.replace(/"/g,"").trim();
      const slug  = cols[3]?.replace(/"/g,"").trim();

      let videoId = "";
      if (url?.includes("watch?v=")) {
        videoId = url.split("watch?v=")[1].split("&")[0];
      } else if (url?.includes("youtu.be/")) {
        videoId = url.split("youtu.be/")[1].split("?")[0];
      } else if (url?.includes("/shorts/")) {
        videoId = url.split("/shorts/")[1].split("?")[0];
      }

      return {
        title,
        url,
        category,
        slug,
        thumb: videoId
          ? `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`
          : ""
      };
    });

    render(data);
  })
  .catch(err => {
    document.getElementById("list").textContent = "読み込みエラー";
    console.error(err);
  });

function render(data) {
  const list = document.getElementById("list");
  list.innerHTML = "";

  const items = soundSlug
    ? data.filter(d => d.slug === soundSlug)
    : data;

  if (!items.length) {
    list.innerHTML = "<p>該当する効果音がありません</p>";
    return;
  }

  items.forEach(item => {
    const a = document.createElement("a");
    a.className = "card";
    a.href = soundSlug ? item.url : `?sound=${encodeURIComponent(item.slug)}`;
    if (soundSlug) a.target = "_blank";

    a.innerHTML = `
      <img src="${item.thumb}">
      <h3>${item.title}</h3>
      <p>${item.category}</p>
    `;

    list.appendChild(a);
  });
}
</script>

</body>
</html>
